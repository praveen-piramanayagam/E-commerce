<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
            text-align: center;
        }
        h2 {
            color: #333;
        }
        #total-amount {
            font-weight: bold;
            color: #27ae60;
        }
        #pay-now-btn {
            background-color: #27ae60;
            color: white;
            font-size: 16px;
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        #pay-now-btn:hover {
            background-color: #2ecc71;
        }
    </style>
</head>
<body>
    <h2>Your Order Summary</h2>
    <p>Total Amount: â‚¹<span id="total-amount">0</span></p>

    <!-- Pay Now button -->
    <button id="pay-now-btn">Pay Now</button>

    <!-- Loading Razorpay Script -->
    <script>
      // Dynamically load the Razorpay script
      const script = document.createElement("script");
      script.src = "https://checkout.razorpay.com/v1/checkout.js";
      script.async = true;

      script.onload = () => {
        console.log("Razorpay script loaded successfully.");
        // Once loaded, enable the Pay Now button
        document.getElementById("pay-now-btn").addEventListener("click", handlePayment);
      };

      script.onerror = () => {
        console.error("Error loading Razorpay script.");
      };

      document.body.appendChild(script); // Append to body

      // Retrieve the final amount from localStorage
      const finalAmount = parseFloat(localStorage.getItem('finalAmount'));

      // Debugging: Check if finalAmount is retrieved correctly from localStorage
      console.log("Retrieved Final Amount from localStorage: ", finalAmount);

      if (isNaN(finalAmount)) {
        alert("Invalid amount passed.");
        return; // Now correctly placed within the function
      }

      // Set the amount dynamically on the page
      document.getElementById("total-amount").textContent = finalAmount;

      // Handle payment logic
      function handlePayment() {
        if (!window.Razorpay) {
          alert("Razorpay SDK not loaded. Please check your internet connection.");
          return; // This return is valid because it's inside the function
        }

        const options = {
          key: "rzp_test_9qlbqULX5I6dyn", // Replace with your Razorpay Test Key
          amount: Math.round(finalAmount * 100), // Convert to paise (smallest currency unit)
          currency: "INR",
          name: "E-Shopping",
          description: "Order Payment",
          handler: function (response) {
            console.log("Payment Successful", response);
            alert("Your order has been placed successfully.");
            // Optionally, redirect to another page after payment
            // window.location.href = "order-success.html"; // Redirect to order success page
          },
          prefill: {
            name: "Praveen",
            email: "Praveennayagam18@gmail.com",
            contact: "9384991464",
          },
          theme: {
            color: "#3399cc",
          },
        };

        // Open Razorpay checkout UI
        const rzp = new window.Razorpay(options);
        rzp.open();
      }
    </script>
</body>
</html>
